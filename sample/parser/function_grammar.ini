function           = _ "function" _ identifier _
                            lpar _                
                            function_arguments _                
                            function_retvals _                
                            rpar
                            _ exp _
                       "end function" _
                    
function_arguments = args_groups_list / _

function_retvals   = ("returns" _ type_list) / _


args_groups_list   = arg_def_group (_ ";" _ arg_def_group)*

arg_def_group      = arg_def_list _ ":" _ type

if                 = "if" _ exp _ "then" _ exp _ "else" _ exp _ "end if"

arg_def_list       = identifier (_ "," _ identifier)*


operand            = call / identifier / number_literal / brackets_algebraic
brackets_algebraic = lpar _ algebraic _ rpar
identifier         = ~"[a-z_][a-z0-9_]*"i

number_literal     = number_literal_int / number_literal_float
number_literal_int = ~"[0-9]+"
number_literal_float = ~"[0-9]+"

exp                = if / algebraic / call / operand

call               = !("function" _) identifier _ lpar _ args_list _ rpar

algebraic          = (operand) (_ bin_op _ operand)*

args_list          = exp (_ "," _ exp)*

lpar               = "("
rpar               = ")"
empty              = ""

_                  = ~"\s*"

bin_op             = "+" / "-" / "<" / ">" / "*" / "/" / "^"
type_list          = type (_ "," _ type)*

type               = ("Array" _ "[" _ type  _"]") / std_type

std_type           = "integer" / "real"
